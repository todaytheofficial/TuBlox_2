<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TuBlox Studio</title>
    <!-- Встроенные стили для удобства, можно вынести в css/studio.css -->
    <style>
        :root {
            --studio-bg: #1e1e1e;
            --studio-panel: #252526;
            --studio-border: #3e3e42;
            --studio-primary: #007acc;
            --studio-text: #cccccc;
            --studio-hover: #2d2d30;
            --studio-accent: #00cec9;
            --studio-danger: #d63031;
            --studio-radius-sm: 4px;
        }
        body { margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; background: var(--studio-bg); color: var(--studio-text); overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
        .ribbon { height: 40px; background: #333333; display: flex; align-items: center; padding: 0 10px; border-bottom: 1px solid #000; gap: 5px; }
        .ribbon button { background: transparent; border: 1px solid transparent; color: #fff; padding: 4px 8px; cursor: pointer; display: flex; align-items: center; gap: 6px; border-radius: 2px; font-size: 13px; }
        .ribbon button:hover { background: rgba(255,255,255,0.1); }
        .ribbon button.btn-primary { background: var(--studio-primary); }
        .workspace { flex: 1; display: flex; position: relative; overflow: hidden; }
        #gameCanvas { background: #1e1e1e; flex: 1; cursor: default; }
        .sidebar { width: 300px; background: var(--studio-panel); border-left: 1px solid var(--studio-border); display: flex; flex-direction: column; z-index: 10; }
        .panel-header { padding: 8px 10px; background: #2d2d30; font-weight: bold; font-size: 12px; text-transform: uppercase; border-bottom: 1px solid var(--studio-border); border-top: 1px solid var(--studio-border); }
        .panel-header:first-child { border-top: none; }
        .content { padding: 10px; overflow-y: auto; flex: 1; }
        .model-tools { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        .model-tool { background: var(--studio-hover); border: 1px solid var(--studio-border); color: #fff; padding: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; border-radius: 3px; }
        .model-tool:hover { background: #3e3e42; }
        .model-tool.active { background: var(--studio-primary); border-color: var(--studio-primary); }
        
        .obj-item { padding: 5px 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 13px; border-radius: 2px; }
        .obj-item:hover { background: #2a2d2e; }
        .obj-item.selected { background: #37373d; border-left: 2px solid var(--studio-primary); }
        
        #properties-panel label { display: block; font-size: 11px; margin-top: 8px; color: #888; }
        #properties-panel input[type="text"], #properties-panel input[type="number"] { width: 100%; background: #333; border: 1px solid #444; color: #fff; padding: 4px; border-radius: 2px; box-sizing: border-box; }
        #properties-panel input[type="color"] { width: 100%; height: 25px; border: none; padding: 0; background: none; cursor: pointer; }
        #properties-panel .prop-toggle-row { display: flex; justify-content: space-between; align-items: center; margin-top: 8px; }
        
        /* Context Menu */
        #context-menu { position: absolute; background: #252526; border: 1px solid #454545; width: 150px; display: none; flex-direction: column; box-shadow: 0 4px 6px rgba(0,0,0,0.3); z-index: 1000; padding: 4px 0; }
        .ctx-btn { background: none; border: none; color: #fff; padding: 8px 12px; text-align: left; cursor: pointer; display: flex; align-items: center; gap: 8px; width: 100%; font-size: 13px; }
        .ctx-btn:hover { background: var(--studio-primary); }
        
        /* Modal */
        #text-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .text-modal { background: var(--studio-panel); padding: 20px; width: 300px; border-radius: 5px; border: 1px solid var(--studio-border); box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .text-modal input, .text-modal select { width: 100%; margin-top: 5px; padding: 8px; background: #333; border: 1px solid #555; color: white; margin-bottom: 10px; box-sizing: border-box; }
        .font-preview { margin-top: 10px; padding: 15px; background: white; color: black; text-align: center; border-radius: 4px; min-height: 40px; display: flex; align-items: center; justify-content: center; border: 1px solid #555; }

        /* TuModels Specifics */
        .models-tab-content { display: none; height: 100%; flex-direction: column; }
        .models-tab-content.active { display: flex; }
        .models-library { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; padding: 10px; overflow-y: auto; max-height: 200px; background: var(--studio-panel); border-radius: var(--studio-radius-sm); margin-bottom: 15px; }
        .model-item { background: var(--studio-surface); border: 1px solid var(--studio-border); border-radius: var(--studio-radius-sm); padding: 10px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .model-item:hover { border-color: var(--studio-primary); background: var(--studio-hover); }
        .model-preview { width: 100%; height: 150px; background: var(--studio-bg); border: 1px solid var(--studio-border); border-radius: var(--studio-radius-sm); position: relative; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .model-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .model-stat { background: var(--studio-bg); padding: 5px; text-align: center; border-radius: 4px; border: 1px solid var(--studio-border); }
    </style>
</head>
<body>
    <!-- Верхняя панель -->
    <div class="ribbon">
        <b>TuBlox Studio</b>
        <div class="divider desktop-only" style="width:1px; height:20px; background:#444; margin:0 10px;"></div>
        
        <button onclick="switchTab('build')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg>
            <span class="btn-text">Build</span>
        </button>
        <button onclick="switchTab('models')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
            <span class="btn-text">TuModels</span>
        </button>
        
        <div style="flex:1"></div>
        
        <button id="save-btn" class="btn-primary">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
            <span class="btn-text">Save</span>
        </button>
        <button onclick="location.href='index.html'" style="background:var(--studio-danger); border-color:var(--studio-danger);">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
            <span class="btn-text">Exit</span>
        </button>
    </div>

    <!-- Рабочая область -->
    <div class="workspace">
        <canvas id="gameCanvas"></canvas>
        
        <div class="sidebar">
            <!-- Вкладка Build -->
            <div id="build-tab" class="models-tab-content active">
                <div class="panel-header">Tools</div>
                <div class="model-tools" style="padding: 10px;">
                    <!-- Стандартные инструменты -->
                    <button class="model-tool active" onclick="setBuildTool('part')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg> Select/Move
                    </button>
                    <!-- НОВАЯ КНОПКА SCALE -->
                    <button class="model-tool" onclick="setBuildTool('scale')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" y1="3" x2="14" y2="10"></line><line x1="3" y1="21" x2="10" y2="14"></line></svg> Scale
                    </button>

                    <div style="grid-column: span 2; height: 1px; background: #444; margin: 5px 0;"></div>

                    <button class="model-tool" onclick="setBuildTool('part'); addPart()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"></rect></svg> Add Part
                    </button>
                    <button class="model-tool" onclick="setBuildTool('spawn'); addSpawn()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg> Add Spawn
                    </button>
                    <button class="model-tool" onclick="setBuildTool('text'); addText()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 7V4h16v3M9 20h6M12 4v16"></path></svg> Add Text
                    </button>
                </div>


                <div class="panel-header">Explorer</div>
                <div id="explorer-list" class="content"></div>

                <div class="panel-header">Properties</div>
                <div id="properties-panel" class="content">
                    <p style="color:#666; text-align:center; padding-top:20px;">Select an object</p>
                </div>
            </div>

            <!-- Вкладка Models -->
            <div id="models-tab" class="models-tab-content">
                <div class="panel-header">Library</div>
                <div class="content">
                    <div id="models-library" class="models-library"></div>
                    
                    <div style="margin-top:20px; font-size:0.8rem; color:#888; text-transform:uppercase;">Preview</div>
                    <div class="model-preview">
                        <div class="preview-empty">Select a model</div>
                        <canvas id="modelPreviewCanvas" style="display:none;"></canvas>
                    </div>
                    
                    <div class="model-stats">
                        <div class="model-stat">
                            <div style="font-weight:bold; color:var(--studio-accent)" id="parts-count">0</div>
                            <div style="font-size:0.7rem; color:#888">Parts</div>
                        </div>
                        <div class="model-stat">
                            <div style="font-weight:bold; color:var(--studio-accent)" id="size-value">0x0</div>
                            <div style="font-size:0.7rem; color:#888">Size</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Контекстное меню -->
    <div id="context-menu">
        <button class="ctx-btn" onclick="duplicateObj()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg> Duplicate
        </button>
        <button class="ctx-btn" onclick="openTextEditor()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg> Edit Text
        </button>
        <button class="ctx-btn delete" onclick="deleteObj()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg> Delete
        </button>
    </div>

    <!-- Модальное окно (Text Editor) -->
    <div id="text-modal-overlay" style="display: none;">
        <div class="text-modal">
            <h3>Edit Text</h3>
            <label>Content</label>
            <input type="text" id="modal-text-input" placeholder="Type text..." oninput="updateFontPreview()">
            
            <label>Font</label>
            <select id="modal-font-select" onchange="updateFontPreview()">
                <option value="Arial">Arial</option>
                <option value="Verdana">Verdana</option>
                <option value="Courier New">Courier New</option>
                <option value="Georgia">Georgia</option>
                <option value="Times New Roman">Times New Roman</option>
                <option value="Impact">Impact</option>
            </select>
            
            <div id="font-preview-box" class="font-preview">Preview Text</div>
            
            <div style="display:flex; gap:10px; margin-top:20px;">
                <button class="btn-primary" onclick="applyText()" style="flex:1; cursor:pointer; background:var(--studio-primary); color:white; border:none; padding:10px; border-radius:3px;">Apply</button>
                <button class="btn-primary" onclick="closeTextModal()" style="flex:1; cursor:pointer; background:#444; color:white; border:none; padding:10px; border-radius:3px;">Cancel</button>
            </div>
        </div>
    </div>
    
    <script src="studio.js"></script>
</body>
</html>